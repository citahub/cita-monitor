groups:
- name: CITA_Alert
  rules:
  # 检查连续1分钟内 instance 是否存活
  - alert: InstanceDown
    expr: up == 1
    for: 1m
    labels:
      severity: high
    annotations:
      summary: "Instance {{ $labels.instance }} down"
      description: "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 1 minutes."
      value: "{{ $value }}"
  # 检查连续1分钟内，块高是否增长
  - alert: BlockNotSync
    expr: avg_over_time(Node_Get_LastBlockNumber[1m]) - Node_Get_LastBlockNumber == 0
    for: 1m
    labels:
      severity: high
    annotations:
      summary: "{{ $labels.instance }} not sync"
      description: "{{ $labels.instance }} of job {{ $labels.job }} has been not sync, current block number is {{ $value }}"
      value: "{{ $value }}"
  # 检查连续1分钟内区块内的 Quota 使用是否超过 70%
  - alert: QuotaUsePercent
    expr: (Node_Get_LastBlockNumberQuotaUsed / Node_Get_BlockQuotaLimit) * 100 > 70
    for: 1m
    labels:
      severity: low
    annotations:
      summary: "{{ $labels.instance }} Quota excessive use"
      description: "{{ $labels.instance }} of job {{ $labels.job }} current quota use percent {{ $value }}"
      value: "{{ $value }}"
